% $Header: /home/mwicks/Projects/Gaspra-projects/cvs2darcs/Repository-for-sourceforge/dvipdfm-initial/doc/dvipdfm.tex,v 1.5 1998/11/18 23:44:04 mwicks Exp $
\special{  pdf:  docview <</PageMode /UseOutlines>>}%
\catcode`\ =11\def\space{ }\catcode`\ =10
% Page layout
\magnification\magstephalf
\advance\hoffset by 0.5truein
\advance\voffset by 0.5truein
\advance\hsize by -1.0in
\advance\vsize by -1.0in
%
%  Some helpful symbols
\def\rtm{{\font\r=cmss10 at 4pt
\font\c=cmsy5
\setbox0\hbox{\c\char13}\skip0\wd0\box0\setbox0\hbox{\r R}\advance\skip0 by
\wd0\kern-0.5\skip0\box0}}
\def\tm{{\font\r=cmss10 at 4pt \hbox{\r TM}}}%
%
%
% Some color definitions
% 
\def\colored#1#2{%
  \special{pdf:bc #1}#2\special{pdf:ec}}%
\def\red#1{\colored{[1 0 0]}{#1}}%
\def\green#1{\colored{[0 1 0]}{#1}}%
\def\blue#1{\colored{[0 0 0.4]}{#1}}%
\def\yellow#1{\colored{[0.8 0.9 0.1]}{#1}}%
%
% Some font definitions
%
\font\maintitlefont=cmss12 at 20.74pt
\font\headingfont=cmss12 at 14.4pt
\font\subheadingfont=cmss12
%
% Miscellaneous token lists
%
\newtoks\title\newtoks\author\newtoks\version
\newtoks\date
%
% Counters for section levels
%
\newcount\sectioncount\newcount\ssectioncount\newcount\sssectioncount
\sectioncount0\ssectioncount0\sssectioncount0
%
\newskip\indentlevel\indentlevel=\parindent
\def\beginlist{\advance\leftskip by \indentlevel\advance\rightskip by
\indentlevel\medskip}
\def\endlist{\par\advance\leftskip by -\indentlevel\advance\rightskip by
-\indentlevel\medskip}
%
\def\settitle{%
  {\maintitlefont\blue{\the\title}}%
  \special {pdf:  docinfo << /Title (\expandafter\the\title) >>}}%
%
\def\setauthor{%
  {\headingfont\blue{\the\author}}%
  \special {pdf:  docinfo << /Author (\the\author) >>}}%
%
\def\setversion{%
  {\subheadingfont{\the\version}}%
}%
\def\setdate{%
  {\subheadingfont{\the\date}}%
}%
\def\setlink#1{\red{#1}}%
%  
\def\setheading#1{%
  {\headingfont\blue{#1}}\raise\baselineskip\hbox{\special{pdf: outline 1 << /Title (#1) /Dest [
@thispage /FitH @ypos ]  >> }}}%
%
\def\setsubheading#1{%
  {\headingfont\blue{#1}}\raise\baselineskip\hbox{\special{pdf: outline 2 << /Title (#1) /Dest [
@thispage /FitH @ypos ]  >> }}}%
%
\def\link#1#2{\setbox0\hbox{\setlink{#1}}%
   \special{pdf: ann width \the\wd0\space height \the\ht0\space depth \the\dp0
     << /Type /Annot /Subtype /Link /Border [ 0 0 0 ] /A << /S /GoTo
     /D (#2) >> >>}\box0}
%
\def\dest#1{\special{pdf:dest (#1) [ @thispage /FitH @ypos ]}}%
%
\def\maketitle{\noindent\settitle\hfill\setauthor\par
          \hrule height 1.0pt\medskip
          \noindent\setversion\hfill\setdate\vskip0.4in}%
%
\def\section#1{\advance\sectioncount by 1\ssectioncount0
\goodbreak\vskip1.5\baselineskip\noindent\setheading{\the\sectioncount. #1}\par\nobreak\medskip}%
\def\subsection#1{\advance\ssectioncount by 1%
\bigskip\indent\setsubheading{\the\sectioncount.\the\ssectioncount\
          #1}\par\nobreak\medskip}%
%
\def\display#1{\medskip\line{\quad #1\hfil}\medskip}
\def\example#1{\noindent{\it Example:\par\nobreak\noindent}}
%
\def\newpage{\vfill\eject}
%
\def\dvipdfm{{\tt dvipdfm}}%
\input verbatim
\def\ttspecial{$\tt\backslash${\tt special}}%
%
\title{Dvipdfm User's Manual}
\author{Mark A. Wicks}
\version{Version 0.7dev}
\date{November, 1998}
\maketitle
\section{Introduction}
This package is a DVI (\TeX) to PDF conversion utility.
This package has the following features:

\beginlist
\item{$\bullet$} A user interface replicating much of the
functionality Adobe Acrobat Distiller$^\rtm$.

\item{$\bullet$} Support for outline (bookmark) entries, named destinations,
annotations (including forms and widgets).

\item{$\bullet$} Ability to include arbitrary PDF files as encapsulated
objects.

\item{$\bullet$} Ability to include JPEG images as encapsulated
objects.

\item{$\bullet$} A color stack.
\endlist
Currently, the widely accepted method to generate PDF file from \TeX\
is to use Distiller$^\rtm$ on a PostScript${\rtm}$
file produced by {\tt dvips}.
The hyperlink features are accessed by using \TeX\ \ttspecial primitives
to embed pdfmarks in the PostScript$^\rtm$ produced by {\tt dvips}.
H\`an Th\'e Th\`an's PDF\TeX\ project is an alternative solution.
Although quite good and fairly mature, the PDF\TeX project required
fairly significant modifications to
\TeX\ itself to add primitives to support the PDF features.
This project demonstrates that much of the functionality
of Acrobat Distiller can be achieved by using a DVI driver.
The PDF features are activated via \TeX\ \ttspecial primitives.

From a technical standpoint,
Distiller$^\rtm$ will probably remain the
best approach for some time.
However, I have several objections to the use of Distiller$^\rtm$
and feel that this driver provides a viable option.
One objection is that Distiller$^\rtm$ isn't available for Linux---my principle
operating system.

My second objection is philosophical.
A DVI file is a page description.
It is essentially a linear program with no branching or decision instructions.
PostScript$^\rtm$ is a complete programming language, while PDF is a page description language
without any branching or decision capabilities.
\TeX\ is like PostScript$^{\rtm}$ (without the graphics)
while DVI is like PDF (without the graphics or the hyperlinks).
Using Distiller$^{\rtm}$ requires going from page description to program back to page description.
Pdfmarks are PostScript$^{\rtm}$ features, which are meant for the Distiller$^{\rtm}$, are
analogous to \TeX \ttspecial primitives, which are meant for the DVI driver.
It seems natural to go directly from DVI to PDF, where \TeX\ replaces
PostScript$^{\rtm}$ and where the DVI driver replaces and implements
\ttspecial primitives similar to the {\tt pdfmarks} in Distiller$^\rtm$.

Unfortunately, until graphics software
begins to produce PDF content streams or encapsulated
PDF objects, PostScript$^{\rtm}$ will remain the easiest
way to include graphics in \TeX\ documents.
I would hope that in the future, graphics programs
will produce PDF content streams, or PDF objects that
may be included into a DVI to PDF translator.  Either
of these may be easily included using {\tt dvipdfm}
or a similar driver.

\section{General Concepts}
This document describes the \dvipdfm\ driver.
It also exercises some of the hypertext features
and serves as a sample input file for
\dvipdfm.
It assumes the reader has some familiarity with the basic features
of the \link{Portable
Document Format}{pdfmanual}.

Each \TeX\ \ttspecial\ 
constitutes a separate command to the \dvipdfm\ 
driver.  Each \ttspecial must begin with {\tt pdf:}
to identify that \ttspecial as a command for the \dvipdfm\ driver.
A \ttspecial\ beginning with any other characters is ignored
by the driver.  Leading spaces are ignored.  The characters {\tt pdf:}
are immediately followed by a \dvipdfm command.  These commands
are documented in Section~3.  Another feature of the driver
is variable expansion within PDF objects---specifically arrays and
dictionaries.  The driver maintains a symbol table.
Some of these variables are user defined and some are
driver defined (read only).  The read only
drivers are for referencing the current page, future pages,
or the current location on the page, for example.
User defined variables are references to user defined PDF objects.


\section{Dvipdfm Commands}
All commands are executed via \TeX\ |\special| primitives
prefixed with {\tt pdf:}, e.g.,
\begintt
\special{ pdf: out 1 << /Title (Introduction)
                        /Dest [ 1 0 R /FitH 234 ] >>
\endtt
\subsection{Ann}
The {\tt ann} command defines an annotation.  Annotations are typically
notes, hyperlinks, PDF forms, or PDF widgets.  The {\tt ann} command
takes the form:
\beginlist
{\tt ann} [{\tt @}{\it name}] {\it dimension}+ {\it PDF\_dictionary}
\endlist
where name is an optional alphanumeric identifier and dictionary
is a valid PDF dictionary after variable expansion.
If {\tt @}{\it name} is specified, it may be used in
other PDF objects to refer to this annotation.
One or more {\it dimension} parameters are required
and each consists of the keyword
{\tt height}, {\tt width}, or {\tt depth} followed
by an appropriate length, specified as per \TeX.  Each
length is a number followed by a unit, such as {\tt pt},
{\tt in}, or {\tt cm}.  A {\tt pt} is a \TeX pt, not a PDF pt.
\begintt
\special{pdf: ann width 144pt height 10pt depth 2pt 
           << /Type /Annot /Subtype /Link /Border [1 0 0] 
              /A << /S /GoTo [ @nextpage /Fit ] >> }
\endtt
\subsection{Out}
The |out| (also |outline|) command adds an outline (also called a ``bookmark'') entry
to the document.
\beginlist
{\tt out} {\it number} {\it PDF\_dictionary}
\endlist
The parameter {\it level} is an integer representing the
level of the outline entry (beginning with 1) and
{\it  PDF\_dictionary} must contain
the two keys {\tt /Title} and either {\tt /Dest} or {\tt /A}.
It may also contain the {\tt /AA} key.  These keys are documented
in the PDF Reference Manual.
\begintt
out 1 << /Title (Section 1) /Dest [ @thispage /FitH @ypos ] >>
\endtt
Which may be followed by
\begintt
out 2 << /Title (Section 1.1) /Dest [ @thispage /FitH @ypos ] >>
\endtt
You may not skip levels.  A level~2 outline entry
must follow a level~1 outline
entry.  A level~3 outline entry must follow a level~2 outline
and cannot immediately follow a level 1 outline entry.

\subsection{Article}
The |article| (or |art|) command initializes an article.  An article
is a collection of boxed regions in the document that should be
read consecutively.  The |article| command takes the form:
\beginlist
{\tt article} {\tt @}{\it name} {\it PDF\_dictionary}
\endlist
The {\it name} parameter is required.  The required PDF dictionary 
is similar to the |docinfo| dictionary and
should include the |/Title| and |/Author| keys.
\begintt
article @somearticle << /Title (Some title) /Author (Me) >>
\endtt
\subsection{Bead}
The |bead| adds a rectangular area to an existing article thread.
It has the form:
\beginlist
{\tt bead} {\tt @}{\it name} {\it dimension}+
\endlist
where {\it dimension}+ specified a rectangular area
in the same manner as for an annotation.  The {\it name}
must correspond with an existing |article|.

\begintt
bead @someart width 156pt height 20pt \space depth 4pt 
\endtt
\subsection{Dest}
The |dest| command defines a named destination.
\beginlist
{\tt dest} {\it PDF\_String} {\it PDF\_Dest}
\endlist
The {\it PDF\_String} is a PDF string naming
the destination.  This string may be used in the destination
fields of annotations and outline entries to refer to
this destination.  {\it PDF\_Dest} is a PDF
destination object (an array).
\begintt
dest (listofreferences) [ @thispage /FitH @ypos ]
\endtt

\subsection{Docinfo}
\beginlist
{\tt docinfo} {\it dictionary}
\endlist
The {\tt docinfo} command adds the keys in the specified dictionary to the
document's Info dictionary.  All keys are optional, but may include
the keys |/Author|, |/Title|, |Keywords|, |Subject|,
and |Creator|.
\subsection{docview}
\beginlist
{\tt docview} {\it dictionary}
\endlist

The {\tt docview} command adds the keys in the specified dictionary to the
document's catalog dictionary.  All keys are optional, but may include
the keys |/PageMode|,
|/URI|, |/OpenAction|, |/AA|
and |ViewerPreferences|.  See the PDF Reference Manual
for documentation of these keys and additional keys.
\subsection{Epdf}
\beginlist
{\tt epdf} [@{\it name}] [{\it dimension}$\|${\it scaling}]+
 {\it PDF\_String}
\endlist
The {\tt epdf} command ``encapsulates'' the first page of a PDF
file named by {\it PDF\_String}
into a PDF XObject.  The resulting XObject is drawn
at the current location of the page.  The current point
represents the lower left-hand corner of the XObject's coordinate
system.  The optional @{\it name} parameter may be used
to reference this object within other objects.  If a
{\it dimension} is supplied, the object will be scaled to fit
that dimension.  A {\it scaling} consists of one of the keywords
|scale|, |xscale|, or |yscale| followed by a number representing
the scaling factor.  Both {\it scaling} and {\it dimension}
parameters can be supplied as long as they are not logically
inconsistent.
\begintt
dpdf yscale 0.50 width 4.0in (circuit.pdf)
\endtt
\subsection{Object}
\beginlist{\tt object} [@{\it name}] {\it object}
\endlist
The |object| (also |obj|) command creates a
PDF object.  The parameter {\it object} is any valid PDF object.  The
parameter {\it name} may be used to refer to this object within other
objects. It will be expanded within
any {\tt special} where a PDF object is
expected. Typically {\it object} is an array
or dictionary.  It may be an empty array or
dictionary that can be constructed dynamically via
the {\tt put} command.
\begintt
object @mydict << /Firstpage @thispage >>
\endtt
\subsection{put}
\beginlist
{\tt put} @{\it name} {\it object}
\endlist
or 
\beginlist
{\tt put} @{\it name} {\it dictionary}
\endlist
The |put| command modifies an existing PDF object created with OBJ.
The first form is used when @{\tt name} is an array.  The second
form is used when @{\tt name} is a dictionary.  Arrays are
incremented one object at a time.  All keys in {\it dictionary}
are added to the dictionary represented by @{\it name}.
\begintt
object @mydict << /Nextpage @thispage >>
\endtt
\subsection{close}
{\tt close} @{\it name}
The {\tt close} writes a PDF object created with |obj| to the PDF file.
No further |put| commands may be executed for this object.
The object may continue to be referenced using @{\it name}
indefinitely.  If the object is never closed, it will
be closed when |dvipdfm| finishes processing the document.

\section{Additional functions}
\subsection{bop}
\beginlist
{\tt bop} {\tt stream}
\endlist
The |bop| command specifies a marking
stream to be generated at the top of each page.

\subsection{eop}
\beginlist
{\tt eop} {\tt stream}
\endlist
The {\tt eop} specifies a marking stream to be generated at the top of each page.

\newpage
\section{References}
\dest{pdfmanual} Portable Document Format Reference Manual, Version
1.2, Adobe Systems Incorporated, 1996.  Available from {\tt
  http://www.adobe.com}. 


\bye
